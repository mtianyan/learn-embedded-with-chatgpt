ä»¥ä¸‹æ˜¯**ç¬¬8å‘¨Â·è¯¾ç¨‹å®‰æ’ä¹‹ç¬¬5é¡¹ï¼šæ•°ç ç®¡æ˜¾ç¤º RTC å®æ—¶æ—¶é—´**çš„å†…å®¹è¯¦è§£ï¼š

---

## ğŸ•“ è¯¾ç¨‹ç›®æ ‡ï¼š

æŒæ¡å¦‚ä½•è¯»å– RTC å®æ—¶æ—¶é’Ÿæ¨¡å—çš„æ—¶é—´ï¼Œå¹¶é€šè¿‡æ•°ç ç®¡ï¼ˆ7 æ®µæ˜¾ç¤ºå™¨ï¼‰æ˜¾ç¤ºå½“å‰çš„æ—¶é—´æ•°æ®ã€‚

---

## ä¸€ã€ç¡¬ä»¶å‡†å¤‡

* STM32F103ï¼ˆæˆ–å…¶ä»– STM32 ç³»åˆ—ï¼‰å¼€å‘æ¿
* RTC æ¨¡å—ï¼ˆå¯ç”¨æ¿è½½ RTC æˆ–å¤–æ¥ DS1302 / DS3231ï¼‰
* æ•°ç ç®¡æ¨¡å—ï¼ˆå…±é˜³ / å…±é˜´ ä»»é€‰ï¼‰
* 74HC595ï¼ˆå¯é€‰ï¼Œç”¨äºèŠ‚çœ GPIOï¼‰
* é¢åŒ…æ¿ä¸è·³çº¿

---

## äºŒã€RTC å®æ—¶æ—¶é’Ÿç®€ä»‹

RTCï¼ˆReal Time Clockï¼‰æ˜¯å®æ—¶æ—¶é’Ÿæ¨¡å—ï¼Œå¯åœ¨æ–­ç”µæƒ…å†µä¸‹ä¾æ—§è®°å½•å½“å‰æ—¶é—´ï¼ˆéœ€é…åˆç”µæ± ï¼‰ã€‚ä¸€èˆ¬å…·æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š

* è®°å½•å¹´æœˆæ—¥ã€æ—¶åˆ†ç§’
* æ”¯æŒé—°å¹´åˆ¤æ–­
* ä½åŠŸè€—ï¼Œå¸¦ç‹¬ç«‹ç”µæºï¼ˆé’®æ‰£ç”µæ± ï¼‰

STM32 æœ‰å†…ç½® RTCï¼Œä¹Ÿå¯ä»¥é€šè¿‡ I2C/SPI æ¥å£å¤–æ¥ RTC èŠ¯ç‰‡ã€‚

---

## ä¸‰ã€æ•°ç ç®¡åŸºç¡€

**æ•°ç ç®¡ç§ç±»ï¼š**

* å…±é˜³æï¼ˆAæ®µæ¥æ­£æï¼ŒGNDæ§åˆ¶ç‚¹äº®ï¼‰
* å…±é˜´æï¼ˆKæ¥åœ°ï¼ŒVCCæ§åˆ¶ç‚¹äº®ï¼‰

**ä½é€‰+æ®µé€‰æ˜¾ç¤ºï¼š**
é€šå¸¸ä½¿ç”¨åŠ¨æ€æ‰«ææ–¹å¼å®ç°å¤šä¸ªä½çš„è½®æµæ˜¾ç¤ºã€‚

**ä½¿ç”¨ 74HC595 æ‰©å±• GPIOï¼ˆå¯é€‰ï¼‰**
èŠ‚çœ MCU çš„ GPIOï¼Œé€šè¿‡ä¸²è¡Œæ–¹å¼æ§åˆ¶ 8bit è¾“å‡ºã€‚

---

## å››ã€é¡¹ç›®è®¾è®¡æ€è·¯

1. åˆå§‹åŒ– RTCï¼Œè®¾ç½®åˆå§‹æ—¶é—´
2. æ¯ç§’è¯»å–å½“å‰æ—¶é—´
3. å°†æ—¶é—´è½¬æ¢ä¸ºæ˜¾ç¤ºæ ¼å¼ï¼ˆå¦‚â€œ14:32â€ï¼‰
4. å°†æ•°å­—åˆ†æ‹†ä¸ºä¸ªä½ã€åä½ç­‰ï¼Œå‘é€ç»™æ•°ç ç®¡
5. åŠ¨æ€æ‰«æåˆ·æ–°æ•°ç ç®¡

---

## äº”ã€å…³é”®ä»£ç é€»è¾‘

### 1. åˆå§‹åŒ– RTCï¼ˆä»¥ STM32 å†…éƒ¨ RTC ä¸ºä¾‹ï¼‰

```c
void RTC_Init(void) {
    RCC->APB1ENR |= RCC_APB1ENR_PWREN;
    PWR->CR |= PWR_CR_DBP;

    RCC->BDCR |= RCC_BDCR_RTCEN | RCC_BDCR_RTCSEL_LSE;

    RTC->CRL |= RTC_CRL_CNF;
    RTC->PRLH = 0;
    RTC->PRLL = 32767;  // 1ç§’ä¸­æ–­
    RTC->CNTH = 0;
    RTC->CNTL = 0;
    RTC->CRL &= ~RTC_CRL_CNF;
}
```

### 2. è·å–å½“å‰æ—¶é—´

```c
uint32_t get_time(void) {
    return RTC->CNTH << 16 | RTC->CNTL;
}
```

---

## å…­ã€æ•°ç ç®¡åŠ¨æ€æ˜¾ç¤ºé€»è¾‘

```c
uint8_t digit_to_seg[10] = {
    0x3F, // 0
    0x06, // 1
    0x5B, // 2
    0x4F, // 3
    0x66, // 4
    0x6D, // 5
    0x7D, // 6
    0x07, // 7
    0x7F, // 8
    0x6F  // 9
};

void display_time(uint8_t hour, uint8_t min) {
    uint8_t digits[4];
    digits[0] = hour / 10;
    digits[1] = hour % 10;
    digits[2] = min / 10;
    digits[3] = min % 10;

    for (int i = 0; i < 4; i++) {
        set_segment(digit_to_seg[digits[i]]);
        select_digit(i);
        delay_ms(2);  // ä¿æŒä¸€ç‚¹æ—¶é—´
        clear_all();
    }
}
```

---

## ä¸ƒã€é¡¹ç›®æ‹“å±•

* æ·»åŠ å¹´æœˆæ—¥æ˜¾ç¤ºåŠŸèƒ½
* æŒ‰é”®è®¾ç½®æ—¶é—´
* æ”¯æŒ DS1302 / DS3231 å¤–éƒ¨ RTC æ¨¡å—ï¼ˆä½¿ç”¨ SPI/I2Cï¼‰

---

## å…«ã€å°ç»“

| æ¨¡å—   | æŠ€æœ¯è¦ç‚¹               |
| ---- | ------------------ |
| RTC  | æ—¶é—´ä¿æŒã€ç”µæ± ä¾›ç”µã€å¯„å­˜å™¨è®¾ç½®    |
| æ•°ç ç®¡  | æ®µç è¡¨ã€åŠ¨æ€æ‰«æã€ä½é€‰æ®µé€‰      |
| é¡¹ç›®æ•´åˆ | å°†æ—¶é—´è½¬æ¢æˆæ˜¾ç¤ºæ ¼å¼å¹¶åˆ†æ—¶åˆ·æ–°æ•°ç ç®¡ |

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ CubeMX + HALï¼Œæˆ‘ä¹Ÿå¯ä»¥æä¾›å¯¹åº”çš„åˆå§‹åŒ–å’Œæ˜¾ç¤ºé€»è¾‘ä»£ç ã€‚æ˜¯å¦éœ€è¦æä¾› HAL ç‰ˆæœ¬æˆ– DS1302 é©±åŠ¨ä»£ç ï¼Ÿ
