下面是第8周·课程内容的第6项：**继电器控制外部设备** 的完整讲解与实操指导。

---

## 🧲 6. 继电器控制外部设备

---

### 🧱 一、课程目标

学会使用 GPIO 控制继电器，从而控制外部设备的开关，如灯泡、电风扇等简单交流/直流负载。

---

### ⚙️ 二、继电器模块简介

继电器是一种**电控开关**，通过较小的电流控制大电流通断。常见模块有以下特性：

| 特性   | 描述                            |
| ---- | ----------------------------- |
| 触点类型 | 常开（NO）、常闭（NC）、公共端（COM）        |
| 驱动方式 | 通常为**低电平触发**（IN=0 → 吸合）       |
| 电气隔离 | 模块带有光耦，MCU 与高压隔离              |
| 电压   | 一般使用 5V 或 12V 模块供电            |
| 负载能力 | 可控 220V AC / 30V DC 等负载（根据型号） |

---

### 🔌 三、继电器接线方式

**1. 控制端连接：**

* VCC → +5V 电源
* GND → 地
* IN → MCU 输出引脚（如 PA0）

**2. 负载接线（控制灯泡等）**

* COM → 火线
* NO（常开） → 接被控电器（如灯泡）
* 电器另一端 → 零线

💡**注意：实际接市电时需注意安全，可以用低压设备如直流电灯代替练习**

---

### 🧠 四、程序控制逻辑

目标：STM32 控制 PA0 输出低电平 → 继电器吸合 → 点亮灯泡

---

### 📄 五、代码示例（基于 STM32 标准库）

#### 1. GPIO 初始化

```c
void Relay_GPIO_Init(void)
{
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);

    GPIO_InitTypeDef gpio;
    gpio.GPIO_Mode = GPIO_Mode_Out_PP;
    gpio.GPIO_Pin = GPIO_Pin_0;
    gpio.GPIO_Speed = GPIO_Speed_50MHz;
    GPIO_Init(GPIOA, &gpio);

    GPIO_SetBits(GPIOA, GPIO_Pin_0); // 初始关闭（高电平）
}
```

#### 2. 控制继电器的函数

```c
void Relay_On(void)
{
    GPIO_ResetBits(GPIOA, GPIO_Pin_0); // 吸合
}

void Relay_Off(void)
{
    GPIO_SetBits(GPIOA, GPIO_Pin_0); // 断开
}
```

#### 3. 简单控制主函数

```c
int main(void)
{
    Relay_GPIO_Init();

    while (1)
    {
        Relay_On();
        delay_ms(1000);

        Relay_Off();
        delay_ms(1000);
    }
}
```

---

### 📦 六、实际测试建议

1. 使用 LED 或蜂鸣器做测试负载，避免初学时接市电
2. 可通过按键输入控制继电器
3. 可与前面课程结合，如：

   * 时间到自动开关灯（配合 RTC）
   * 红外遥控控制继电器
   * 用串口发送指令控制继电器

---

### 📌 七、总结

| 知识点   | 说明                  |
| ----- | ------------------- |
| IO 控制 | 输出高/低电平控制继电器模块      |
| 电平逻辑  | 多数模块为低电平触发（IN=0 吸合） |
| 保护措施  | 电源隔离、光耦保护、加二极管防反灌电流 |
| 安全    | 控制高压负载时应注意漏电保护与绝缘处理 |

---

如你使用的是 HAL 或 CubeMX，我也可以提供 HAL 版本的继电器控制代码。需要我补充这部分吗？
